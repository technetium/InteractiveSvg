
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
</head>
<body>

https://eloquentjavascript.net/15_event.html
http://tutorials.jenkov.com/svg/svg-and-css.html
https://help.github.com/articles/what-is-github-pages/
https://rawgit.com/technetium/InteractiveSvg/master/canvas.html

mousedown
enter
<style>
	svg.tc_svg_edit g.node { 
		fill: #CCF;
		opacity: 0.1;
		r: 10;
		stroke: #00F;
		stroke-width: .5;
	}
	svg.tc_svg_edit:hover g.node { 
		opacity: 0.5;
	}
	svg.tc_svg_edit:hover g.node:hover { 
		cursor: move;
		opacity: 1;
	}
</style>
<script>
	console.log("script");
	
	//document.getElementById("MyElement").classList.add("MyClass");
    //document.getElementById("MyElement").classList.remove("MyClass");
	//document.addEventListener("click", onClick);
	
	function onClick(e) {
		console.log("onClickMain");
		console.log(e);
	}
	function onButtonClick(e) {
		console.log("onButtonClick");
		console.log(e);
	}
	
	class TcSvgEdit {

	constructor(prefix) {
			console.log("construct");
			
			TcSvgEdit.node_circle_radius = 5;
			TcSvgEdit.node_cross_radius = 11;
			TcSvgEdit.prefix = "tc_svg_edit_";
			TcSvgEdit.svg_namespace = "http://www.w3.org/2000/svg";
			
			if ("undefined" !== typeof prefix) { TcSvgEdit.prefix = prefix; }
			document.addEventListener("mousedown", function(event){
				TcSvgEdit.onMouseDown(event);
			});
			document.addEventListener("mousemove", function(event){
				TcSvgEdit.onMouseMove(event);
			});
			document.addEventListener("mouseup", function(event){
				TcSvgEdit.onMouseUp(event);
			});
		}
		
		//
		// Event Listeners
		//
		
		static onMouseDown(event) {
			console.log("TcSvgEdit.onMouseDown");
			console.log(event);
			TcSvgEdit.svgOnMouseDown(event);
		}
		
		static onMouseMove(event) {
			///console.log("TcSvgEdit.onMouseMove");
			///console.log(event);
			TcSvgEdit.svgOnMouseMove(event);
		}

		static onMouseUp(event) {
			console.log("TcSvgEdit.onMouseUp");
			console.log(event);
			TcSvgEdit.svgOnMouseUp(event);
		}

		//
		// node
		//
		
		static nodeOnMouseDrag(node, event) {
			console.log("nodeOnMouseDrag");
			console.log(event);
		}
		
		//
		// svg
		//
		
		static svgOnMouseDown(event) {
			let svg = event.target.closest("svg.tc_svg_edit");
			if (null === svg) { return; }
			
			let node = event.target.closest(".node");
			if (null !== node) {
				console.log(node);
				svg.setAttribute(TcSvgEdit.prefix + "_selected", node);
				console.log("selected");
				console.log(svg.getAttribute(TcSvgEdit.prefix + "_selected"));
				return;
			}
			
			console.log(svg);
			let pos = TcSvgEdit.utilGetSvgCoordinates(svg, event);
			console.log(pos);
			TcSvgEdit.svgAddNode(svg, pos.x, pos.y);
		}

		static svgOnMouseMove(event) {
			let svg = event.target.closest("svg.tc_svg_edit");
			if (null === svg) { return; }
			if (!svg.hasAttribute(TcSvgEdit.prefix + "_selected")) {
				return;
			}
			TcSvgEdit.nodeOnMouseDrag(
				svg.getAttribute(TcSvgEdit.prefix + "_selected"),
				event
			);
		}

		static svgOnMouseUp(event) {
			let svg = event.target.closest("svg.tc_svg_edit");
			if (null === svg) { return; }
			svg.removeAttribute(TcSvgEdit.prefix + "_selected");
		}
		

		static svgAddNode(svg, x, y) {
			console.log("svgAddNode("+x+", "+y+")");
			let g = TcSvgEdit.createSvgElement("g");
			g.classList.add("node");
	
			// inatialise element
			let e = null; 

			// Circle
			e = TcSvgEdit.createSvgElement("circle");
			e.setAttribute("cx", x);
			e.setAttribute("cy", y);
			e.setAttribute("r", TcSvgEdit.node_circle_radius);
			g.append(e);
			
			// Horizontal cross hair
			e = TcSvgEdit.createSvgElement("line");
			e.setAttribute("x1", x - TcSvgEdit.node_cross_radius);
			e.setAttribute("y1", y);
			e.setAttribute("x2", x + TcSvgEdit.node_cross_radius);
			e.setAttribute("y2", y);
			e.setAttribute("r", TcSvgEdit.node_circle_radius);
			g.append(e);

			// Vertical cross hair
			e = TcSvgEdit.createSvgElement("line");
			e.setAttribute("x1", x);
			e.setAttribute("y1", y - TcSvgEdit.node_cross_radius);
			e.setAttribute("x2", x);
			e.setAttribute("y2", y + TcSvgEdit.node_cross_radius);
			e.setAttribute("r", TcSvgEdit.node_circle_radius);
			g.append(e);

			svg.append(g);
			console.log(g);
		}

		// Because I"m to lazy to type the namespace
		static createSvgElement(name) {
			return document.createElementNS(TcSvgEdit.svg_namespace, name);
		}
		
		static utilGetSvgCoordinates(svg, event) {
			console.log("utilGetSvgCoordinates()");
			// @see https://stackoverflow.com/questions/12752519/svg-capturing-mouse-coordinates
			let pt = svg.createSVGPoint();
			pt.x = event.clientX;
			pt.y = event.clientY;

			// The cursor point, translated into svg coordinates
			let cursorpt =  pt.matrixTransform(svg.getScreenCTM().inverse());
			console.log("(" + cursorpt.x + ", " + cursorpt.y + ")");
			return cursorpt;
		}		
	}

	new TcSvgEdit("someprefix");
</script>


addEventListener("click", function(){modifyText("four")}, false);

<button>Click me</button>
<button>Click me</button>
<p>No handler here.</p>
<script>
  let buttons = document.querySelectorAll("button");
	buttons.forEach(function(button) {
	///console.log(button);
	button.addEventListener("click", onButtonClick);
});
  
  </script>


<svg version="1.1"
     xmlns:svg="http://www.w3.org/2000/svg"
     xmlns="http://www.w3.org/2000/svg"
     width="500" height="240"
	class="tc_svg_edit"
	id="svg1"
>    

    
</svg>

<svg version="1.1"
     xmlns:svg="http://www.w3.org/2000/svg"
     xmlns="http://www.w3.org/2000/svg"
     width="500" height="240"
	class="not_tc_svg_edit"
	id="svg2"
>
   <g transform="translate(280,100)" >
        <circle class="control_point" cx="0" cy="0" r="10"  />
        <circle class="point4 invisible" cx="0" cy="0" r="3" />
    </g>
</svg>

<svg version="1.1"
     xmlns:svg="http://www.w3.org/2000/svg"
     xmlns="http://www.w3.org/2000/svg"
     width="500" height="240"
	class="tc_svg_edit"
	id="svg3"
>
   <g transform="translate(280,100)" >
        <circle class="control_point" cx="0" cy="0" r="10" />
        <circle class="point4 invisible" cx="0" cy="0" r="3" />
    </g>
</svg>

  function getAbsolutePosition(element) {
    var r = { x: element.offsetLeft, y: element.offsetTop };
    if (element.offsetParent) {
      var tmp = getAbsolutePosition(element.offsetParent);
      r.x += tmp.x;
      r.y += tmp.y;
    }
    return r;
  };

</body>
</html>